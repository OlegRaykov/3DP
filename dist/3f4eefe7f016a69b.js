import*as THREE from"three";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader";import init from"./init";import"./style.css";const{sizes,camera,scene,canvas,controls,renderer}=init();camera.position.set(0,20,-70);const hemiLight=new THREE.HemisphereLight(16777215,16777215,.23);hemiLight.position.set(0,50,0),scene.add(hemiLight);const dirLight=new THREE.DirectionalLight(16777215,.54);dirLight.position.set(2,12,4),dirLight.castShadow=!0,dirLight.shadow.mapSize=new THREE.Vector2(1024,1024),scene.add(dirLight);const clickableObjects=[],interactiveObjects=[],addObjectWithLink=(e,t)=>{clickableObjects.push({object:e.scene,url:t}),scene.add(e.scene)};function addObjectWithTooltip(e,t){e.userData.tooltipText=t,interactiveObjects.push(e),scene.add(e)}const loader=new GLTFLoader;loader.load("models/Chasovnya/Chasovnya.gltf",(e=>{console.log(e),e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0),addObjectWithLink(e,"https://www.youtube.com/watch?v=6_uAAzbv4IE");const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Часовня"),scene.add(e.scene)})),loader.load("models/LaboraK/LaboraK.gltf",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0),addObjectWithLink(e,"https://www.youtube.com/watch?v=I9gLrRwLFCs&t=1s");const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Лабораторный корпус (ЛК)"),scene.add(e.scene)})),loader.load("models/Glavniy/Glavniy.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0);const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Главный корпус (ГЛ)"),scene.add(e.scene)})),loader.load("models/Gorniy/Gorniy.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0);const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Горный корпус (ГК)"),scene.add(e.scene)})),loader.load("models/Him/Him.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0);const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Химический корпус"),scene.add(e.scene)})),loader.load("models/RT/RT.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0);const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Робототехнический Корпус (РТ)"),scene.add(e.scene)})),loader.load("models/Energo/Energo.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0);const t=e.scene;t.scale.set(1,1,1),t.position.set(0,0,0),addObjectWithTooltip(t,"Энергетический корпус (ЭН)"),scene.add(e.scene)})),loader.load("models/Plane/Plane.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0),scene.add(e.scene)})),loader.load("models/Stadion/Stadion.glb",(e=>{e.scene.scale.set(1,1,1),e.scene.position.set(0,0,0),scene.add(e.scene)}));const tick=()=>{controls.update(),renderer.render(scene,camera),window.requestAnimationFrame(tick)};tick(),window.addEventListener("resize",(()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer.render(scene,camera)})),window.addEventListener("dblclick",(()=>{document.fullscreenElement?document.exitFullscreen():canvas.requestFullscreen()}));var raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;function onClick(e){mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera);var t=raycaster.intersectObjects(clickableObjects.map((e=>e.object)),!0);if(t.length>0){let e=t[0].object;for(;e.parent&&!clickableObjects.some((t=>t.object===e));)e=e.parent;const s=clickableObjects.find((t=>t.object===e));s&&s.url&&(console.log("Переход по ссылке:",s.url),window.open(s.url,"_blank"))}}function showTooltip(e){const t=document.getElementById("tooltip");t.textContent=e,t.style.display="block"}function hideTooltip(){document.getElementById("tooltip").style.display="none"}function onMouseMove(e){mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera);var t=raycaster.intersectObjects(interactiveObjects,!0);if(t.length>0){for(var s=t[0].object;s&&!s.userData.tooltipText;)s=s.parent;s?showTooltip(s.userData.tooltipText):hideTooltip()}else hideTooltip()}renderer.domElement.addEventListener("click",onClick),renderer.domElement.addEventListener("mousemove",onMouseMove);